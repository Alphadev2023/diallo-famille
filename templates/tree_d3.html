{% extends "include/base.html" %} 
{% block title %}Page d'accueil{% endblock %}
{% block content %}
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
      .node circle {
        fill: #999;
      }
      .node text {
        font: 12px sans-serif;
      }
      .link {
        fill: none;
        stroke: #555;
        stroke-width: 1.5px;
      }
    </style>
  </head>
  <body>
    <h2>Vue graphique de l'arbre</h2>
    <svg width="1200" height="600"></svg>
    <script>
      fetch("{% url 'tree_data' person.code_unique %}")
        .then((res) => res.json())
        .then((data) => {
          const root = d3.hierarchy(data);
          const treeLayout = d3.tree().size([600, 800]);
          treeLayout(root);

          const svg = d3
            .select("svg")
            .append("g")
            .attr("transform", "translate(10,0)");

          svg
            .selectAll(".link")
            .data(root.links())
            .enter()
            .append("path")
            .attr("class", "link")
            .attr(
              "d",
              d3
                .linkVertical()
                .x((d) => d.y)
                .y((d) => d.x)
            );

          const node = svg
            .selectAll(".node")
            .data(root.descendants())
            .enter()
            .append("g")
            .attr("class", "node")
            .attr("transform", (d) => `translate(${d.y},${d.x})`);

          node.append("circle").attr("r", 5);
          node
            .append("text")
            .attr("x", 10)
            .attr("dy", 3)
            .text((d) => d.data.name);
        });
    </script>
{% endblock %}
